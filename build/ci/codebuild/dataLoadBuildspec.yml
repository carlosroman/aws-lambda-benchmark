version: 0.2

env:
  variables:
    GO111MODULE: on

phases:

  install:
    commands:
    # Print all environment variables (handy for AWS CodeBuild logs)
    - make info

  build:
    commands:
      - export TABLE_NAME=`aws cloudformation describe-stacks --stack-name ${APP_STACK} | jq -r -c '.Stacks[0].Outputs[] | select(.OutputKey == "DynamoDBTable").OutputValue'`
      - export TABLE_REGION="$AWS_REGION"
      - make info load-data

cache:
  paths:
  - '/go/pkg/mod/**/*'
